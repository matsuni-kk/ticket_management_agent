---
file_type: "response"
ticket_id: "TKT-20250808-001"
responder: "國松"
response_date: "2025-08-08"
status: "最終回答"
resolution_status: "解決済"
issued_at: "2025-08-08"
due_date: ""
ball_holder: "クローズ"
---

片田さん、はじめまして。状況共有ありがとうございます。まずは切り分けと回復を優先して、以下の順でご確認ください。

1) スコア閾値をオフ、`top_k` を高め（50〜200）で検索
- 候補がゼロでないか、まず取得母数を確保して挙動確認します。

2) 埋め込みの整合性回復（全量再埋め込み）
- ナレッジ設定で Embedding モデルを一度日本語に強いモデルへ切替→元に戻すことで再埋め込みを発生させ、混在を解消します。
- 再埋め込み完了を待ってから再検索で比較ください。

3) 検索モードの再評価（短文データ特性）
- ハイブリッドを基本としつつ、全文単独/ベクトル単独と比較し、最も再現率が高いものを特定します。
- Rerank は候補を十分取れることを確認した後にオンにします。

4) データ前処理の適用（GAS）
- 正規化（大小/全半角/カナ/記号/スペース）した `keyword_norm` カラムの追加。
- 代表語（canonical）や同義語の列を追加し、検索の当たり幅を広げる。

5) 小規模ABテスト
- 代表KW 50〜200件のテスト用ナレッジを作成し、設定（`top_k`/閾値/ハイブリッド/Rerank）でABを実施します。

追加で、以下をご共有いただければ精度高く調整提案できます。
- 現在の検索設定画面のスクリーンショット（検索タイプ、`top_k`、閾値、Rerank、チャンク設定）
- 利用中の埋め込みモデルと変更履歴
- ヒットしない具体的キーワード例（5〜10件）
- GAS側の前処理内容（正規化・重複排除など）

ご提供次第、設定の具体値（例: `top_k` 推奨、閾値目安、前処理レシピ）まで詰めてご提案します。

---

【進捗共有 2025-08-08】
- 閾値オフ＋ハイブリッド等の確認結果：ヒットしない/精度低下のケースを再現。
- Embeddingモデルを切替→戻し（全量再埋め込み）後、一部クエリ（例: キッチンバサミ）は改善。
- ただし「空気清浄機」等では、完全一致チャンクがあるのに null となるケースあり。
- 現時点の見立て：インデックス側の不整合/エラーが残っている可能性。

【次の提案アクション】
1) ナレッジのインデックス状態/ログを確認（失敗件数・エラー詳細）。
2) 対象ナレッジの「インデックス再構築（rebuild）」を実行（スモールセットで先行）。
3) 同一ベクトルDB/同一ドキュメントかを確認（別DBなら各々再埋め込み＋再構築が必要）。
4) 再構築後、代表KW（空気清浄機等）でAB（ベクトル/全文/ハイブリッド、Rerank有無、`top_k`/閾値）。

実施可否と、ベクトルDB/ドキュメントの範囲をご指定ください。こちらで手順を簡潔に共有し、再現性のある検証項目を整備します。

---

【最終対応内容 2025-08-08】
- 原因: ナレッジのインデックス作成ジョブでエラーが発生し、一部チャンクが正しくインデックス化されていなかった。
- 対応: Embeddingモデルを切替→元に戻して全量再埋め込みを実施。その後、インデックスを再実行（クラウド版のためAPI枠待ち後に完了）。
- 結果: 全キーワードで検索ヒットを確認。顧客より「直りました！」の確認取得。

【再発防止・運用メモ】
- モデル混在防止: モデルを変更した場合は必ず全量再埋め込み。
- 日本語最適モデル: 日本語短文中心のため、日本語に強いEmbeddingモデルを採用。
- インデックス監視: ナレッジのインデックス/ジョブログで失敗件数を定期チェック。問題時はrebuildを優先実施。

## 原因
ナレッジのインデックス作成ジョブのエラーにより、一部チャンクが未インデックス化。

## 解決方法
Embeddingモデルの切替→戻しで全量再埋め込み後、インデックス再実行（必要に応じrebuild）。

## 顧客確認・検証結果
代表KWでの再検索でヒットを確認し、顧客から「直りました！」の確認を取得（2025-08-08 18:57）。
