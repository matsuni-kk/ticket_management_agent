---
file_type: "inquiry"
ticket_id: "TKT-20250819-001"
company: "My Best"
reporter: "Kaho Nagaso"
date: "2025-08-19"
status: "新規"
category: "技術的問題"
priority: "高"
related_tickets: ["TKT-20250806-002"]
related_systems: ["Dify", "LLM重複除去", "構造化出力", "Amazon", "楽天", "Yahoo", "価格.com"]
technical_issue: "段階的重複除去の構造化出力が正常に動作しない"
issued_at: "2025-08-19"
due_date: ""
ball_holder: "当方"
---

# 問い合わせ内容 - 段階的商品重複除去の構造化出力問題

## 問い合わせ者: Kaho Nagaso
## 問い合わせ日時: 2025-08-19 12:12

@matsuni
まつにいさん、お疲れ様です！
先日商品重複を排除するLLMのご相談をさせていただいた際に、分けたほうがいいというようなお話があったので、amazon/楽天・yahoo/価格の2つで分けて重複を確認させて、その後に出てきた2つから重複を確認させるというようにして、段階的に作業させるようにしたのですが、LLMのところが何回やってもうまくいかず..😭

構造化出力自体がそもそもうまくいかなかったので、一旦構造化を切りながらやっているのですが、ここの重複削除のところをうまく機能させるにはどうしたらよいでしょうか..？😿

yml.貼らせていただきますので、一度ご確認いただけますと幸いです

## 技術的詳細

### 前回問題の状況（関連チケット: TKT-20250806-002）
- **元の問題**: 全商品データを一括でLLMに送信すると649,032 tokens という膨大な量になり処理不可
- **提案された解決策**: 段階的処理による分割アプローチ
- **実装アプローチ**: amazon/楽天 グループと yahoo/価格.com グループに分割

### 現在の実装状況
- **分割処理**: amazon/楽天 と yahoo/価格.com の2つのグループに分割済み
- **段階的処理**: 各グループで重複除去 → 2つの結果を最終統合
- **新たな問題**: 構造化出力が正常に動作しない

### 実装上の課題
1. **構造化出力の失敗**
   - LLMの構造化出力機能が期待通りに動作しない
   - 何度実行しても正常な結果が得られない

2. **現在の対処方針**
   - 構造化出力を一時的に無効化
   - 代替手法で重複除去の実装を模索

3. **求める支援**
   - 重複削除機能を確実に動作させる方法
   - YAML設定の確認・最適化

## 関連システム
- **Dify**: メインのワークフロー管理システム
- **LLM**: 商品重複除去の判定エンジン
- **データソース**: Amazon, 楽天, Yahoo Shopping, 価格.com

## 前提条件
- 前回チケット（TKT-20250806-002）で段階的処理アプローチが推奨済み
- 基本的な分割処理は実装完了
- YAML設定ファイルが準備済み（後日提供予定）

## 期待する結果
1. 段階的重複除去処理の正常動作
2. 構造化出力問題の解決または代替手法の提案
3. YAMLファイルの設定最適化

## 関連チケット
- **TKT-20250806-002**: Fire Crawl商品重複除去の入力値制限問題
  - 同一報告者（Kaho Nagaso）
  - 同一システム（商品重複除去）
  - 前回提案の段階的処理アプローチを実装中
  - 技術的継続案件として密接に関連