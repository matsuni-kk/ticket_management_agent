---
file_type: "response"
ticket_id: "TKT-20250823-001"
responder: "matsuni"
response_date: "2025-08-23"
status: "対応中"
resolution_status: "対応中"
issued_at: "2025-08-23"
due_date: ""
ball_holder: "先方"
---

# 商品コンテンツ自動生成品質差異問題への対応状況

## 原因
**GAS×API vs 管理画面×API の品質差異の主要因**：
1. **プロンプト構造の微細な差異**: SystemプロンプトとUserプロンプトの設定が環境間で完全一致していない
2. **入力値の形式・構造差異**: スプレッドシートと管理画面での入力データ形式の違い
3. **API呼び出しパラメータの差異**: 環境ごとの設定値やオプションの違い

## 解決方法

### 実施済み対応
1. **Difyワークフローの改善**
   - プロンプト強化の実施
   - モデル変更による品質向上
   - System/Userプロンプト分離による出力安定化

2. **設定最適化**
   ```yaml
   LLMノード設計:
     System Prompt: 普遍的なルールと指示
     User Prompt: 変数・変動値のみ
   効果: LLM出力の安定性向上
   ```

### 次のアクション（顧客側）
1. **未定義変数の修正**
   - ワークフロー内の入力変数定義を完了
   - 画像関連設定の手動調整

2. **環境間設定の完全一致確認**
   - GAS側とシステム側のプロンプト完全比較
   - APIログでの実際の呼び出し内容確認

### 検証方法
実際の入力値を使った動作確認により、両環境での出力品質統一を達成

## 顧客確認・検証結果
**現在の状況**：
- ワークフロー改善版を提供済み
- 顧客側での変数定義修正待ち
- 修正完了後に本格的な品質検証が可能

**期待される効果**：
- 両環境での出力品質の統一
- 商品コンテンツ生成業務の安定化・効率化

引き続き、変数修正完了後の検証結果をお待ちしております。