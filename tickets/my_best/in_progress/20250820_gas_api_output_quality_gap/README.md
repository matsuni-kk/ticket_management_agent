---
file_type: "ticket_summary"
ticket_id: "TKT-20250820-001"
title: "商品コンテンツ自動生成のAPI出力品質格差問題"
company: "My Best"
reporter: "Minami Sasaki"
create_date: "2025-08-20"
update_date: "2025-08-20"
status: "新規"
category: "技術的問題"
priority: "高"
assigned_to: "技術チーム"
estimated_hours: 6
problem_type: "API実装間の出力品質格差"
technical_focus: "GAS×API vs 管理画面×API の品質差分析"
workflow_file: "商品_自動生成コンテンツ.yml"
urgency: "直前相談・早急対応要"
issued_at: "2025-08-20"
due_date: ""
ball_holder: "当方"
---

# チケット: 商品コンテンツ自動生成のAPI出力品質格差問題

## 基本情報
- **チケットID**: TKT-20250820-001
- **タイトル**: 商品コンテンツ自動生成のAPI出力品質格差問題
- **会社名**: My Best
- **報告者**: Minami Sasaki
- **作成日**: 2025-08-20
- **ステータス**: 新規
- **優先度**: 高
- **緊急性**: 直前相談・早急対応要

## サマリー
商品検証データから商品コンテンツを自動生成する際、GAS×APIと管理画面×APIで出力品質に大きな格差が発生。同一APIを使用しているにも関わらず管理画面側の品質が著しく低く、Dify活用による解決を検討中。ワークフロー（商品_自動生成コンテンツ.yml）の最適化と品質差の原因分析が急務。

## 原因（判明している範囲／仮説）

### 直接的要因（推定）
- **プロンプト構造の相違**: systemプロンプトとuserプロンプトの微細な差異
- **入力値の構造化レベル**: GASと管理画面でのデータ整形の違い
- **API呼び出し方式**: リクエスト形式や パラメータの差異
- **コンテキスト管理**: セッション管理や状態保持の違い

### システム間の技術格差
1. **GAS×API（高品質側）**
   - シンプルな実装環境
   - 直接的なAPI呼び出し
   - 状態管理が明確

2. **管理画面×API（低品質側）**
   - 複雑なシステム統合
   - 中間処理レイヤーの存在
   - 状態管理の複雑化

### 根本的課題
- **検証不足**: 双方の実装で実際のプロンプト構造が一致しているか未確認
- **ログ分析不足**: APIレベルでの詳細な比較検証が未実施
- **ワークフロー最適化余地**: Difyワークフローの改善ポイントが未特定

## 解決方法（実施手順・設定値）

### Phase 1: 根本原因分析（即座実行）
1. **API呼び出し構造の比較分析**
   ```
   対象: GAS実装 vs 管理画面実装
   確認項目:
   - systemプロンプトの完全一致確認
   - userプロンプトの構造・内容比較
   - 入力データの前処理方式
   - APIパラメータ（temperature, max_tokens等）
   ```

2. **APIログの詳細分析**
   ```
   分析対象:
   - リクエストボディの完全な構造比較
   - レスポンス品質の定量的評価
   - エラー・警告ログの差分確認
   - 処理時間・リソース使用量の比較
   ```

### Phase 2: Difyワークフロー最適化
1. **提供ワークフロー（商品_自動生成コンテンツ.yml）の分析**
   ```yaml
   分析観点:
   - ノード構成の最適性
   - データフローの効率性
   - プロンプト設計の妥当性
   - モデル選択の適切性
   ```

2. **品質向上のための改善実装**
   ```
   改善項目:
   - 適切なLLMモデルの選定・配置
   - プロンプトエンジニアリングの最適化
   - 入力データの構造化改善
   - 出力品質の検証・フィードバック機能
   ```

### Phase 3: 統合・検証
1. **品質統一のためのベストプラクティス確立**
   - GAS側の成功パターンの管理画面への適用
   - Dify活用による品質安定化の実現
   - 継続的品質監視体制の構築

2. **本番適用・運用開始**
   - 段階的な切り替え実施
   - 品質メトリクスの継続監視
   - フィードバックサイクルの確立

## 技術的分析ポイント

### 重点調査項目
1. **プロンプト精密比較**
   - 文字レベルでの完全一致確認
   - エスケープ処理・文字コードの相違
   - 改行・空白文字の扱いの差異

2. **データ前処理の差分**
   - 入力データのクレンジング方式
   - 構造化・正規化の処理差
   - メタデータの付与方式

3. **API実行環境の相違**
   - 実行タイミング・頻度
   - 並列処理・キューイング
   - キャッシュ・セッション管理

### Difyワークフロー最適化観点
- **モデル選定**: 商品コンテンツ生成に最適なLLMの選択
- **ステップ構成**: 効率的なワークフロー設計
- **品質管理**: 出力品質の自動評価・改善機能
- **スケーラビリティ**: 大量処理時の安定性確保

## 期待される改善効果

### 品質面の向上
- **出力品質の統一**: GASレベルの高品質を管理画面でも実現
- **安定性の確保**: システム間での品質バラつき解消
- **精度向上**: Dify活用による更なる品質向上

### 運用面の効率化
- **開発効率**: 品質問題による手戻りの削減
- **運用コスト**: 手動修正作業の大幅削減
- **拡張性**: 他の商品コンテンツ生成への応用

## 実装優先度と次のアクション

### 緊急対応（24時間以内）
- [ ] GAS×APIと管理画面×APIの詳細比較分析
- [ ] APIログの取得・分析実施
- [ ] プロンプト構造の完全一致確認

### 高優先（3日以内）
- [ ] 商品_自動生成コンテンツ.yml の分析・改善案作成
- [ ] 適切なモデル選定とワークフロー最適化
- [ ] テスト環境での改善効果検証

### 中優先（1週間以内）
- [ ] 本番環境への改善適用
- [ ] 品質監視体制の構築
- [ ] 継続的改善サイクルの確立

## 関連チーム・連携体制
- **技術チーム**: @Amane Inoue @Nobuko Iwasa
- **エスカレーション**: matsuni さん・miyatti さんへの直接連携
- **情報共有**: 追加情報は当チケット経由で連携

この問題の解決により、商品コンテンツ自動生成の品質が大幅に向上し、My Bestの商品紹介コンテンツの質と効率が劇的に改善されることが期待されます。

## 再発防止・運用メモ
- API実装時は必ず両環境での品質検証を実施
- プロンプト変更時は全システムでの同期確認を徹底
- 定期的な品質監査によるシステム間格差の早期発見