---
file_type: "ticket_summary"
ticket_id: "TKT-20250812-001"
title: "公式ページ検索ノードが類似商品/別型番を取得する問題"
company: "マイベスト"
reporter: "Kano Sakuma"
create_date: "2025-08-12"
update_date: "2025-08-13"
deadline: ""
status: "解決済"
category: "技術的問題"
priority: "中"
assigned_to: "matsuni"
owner: "担当者確定"
next_action: "先方からの再検証結果の受領待ち"
ball_holder: "先方"
estimated_hours: "TBD"
final_resolution_date: ""
customer_confirmation: "未確認（先方返答待ち）"
issued_at: "2025-08-12"
due_date: ""
---

## サマリー
「★検証_紹介文（1段落目）生成」のワークフローにおいて、`公式ページ検索` ノードが類似商品や別型番、別カテゴリ（例: 施設/イベント名など）を誤って採用してしまう。特に商品名が一般名詞に近い場合や、百均系など公開情報が少ない商材で誤取得が発生。

## 影響範囲
- 生成される紹介文の事実誤り（ブランド/カテゴリ/型番の取り違え）
- 誤情報の公開リスク、編集工数の増加

## 想定原因
- 検索クエリにブランド/カテゴリ/型番等の拘束が弱い、`site:` 制約未活用
- 公式ドメイン優先ロジック/ドメイン許可リストの欠如
- 取得ページからの同一定義（Product Identity）抽出・検証が未実装
- 情報が少ない商材でランキングがノイズに引っ張られる（検索エンジン側スコアに依存）

## 初期対応方針（3層ディフェンス）
1) 検索段階: ブランド＋商品名（必要に応じて型番/カテゴリ）を引用符で厳密化、`site:公式ドメイン OR "公式"` を活用。既知の誤ヒット語を `-除外語` で抑制。
2) 抽出段階: 候補ページから `ブランド/商品名/型番/カテゴリ` を構造化抽出（JSON）。
3) 検証段階: LLM/ルールで同一性検証（ブランド一致、カテゴリ一致、型番一致が必須。非一致はrejectし次候補へフォールバック）。

## 相談内容（要約）
- 公式ページ検索ノードで誤情報を取得するケースの解消依頼。
- 事実チェック用のLLMを噛ませたいが、具体設定の助言希望。

### 具体的な発生事例
1) 「ウォーターサーバー」商材の「メーカー: ウォーターランド、商品名: ウォーターランド（公式）」に対し、公園施設「ウォーターランド」を誤採用し、施設説明文が最終出力された。
2) AGF「ちょっと贅沢な珈琲店 スペシャルブレンド」について、商材がコーヒー豆にもかかわらず、スティックタイプのインスタントコーヒー情報を出力（検索クエリに商材名の明示が不足）。

## 実施した対応（2025-08-13）
- 検索クエリの明確化: Tavily 等の検索ノードで「商材名・メーカー名・製品名（必要時 型番）」を明示。クエリに「公式/製品情報」語を追加。
- ドメイン制約: `site:公式ドメイン`（またはブランド公式）を優先。許可リスト/除外リストを導入。
- 除外語の付与: 施設系/レジャー等の誤ヒットを `-公園 -イベント -施設 -スライダー` で抑制。
- LLM同一性バリデータ導入: Identity抽出（brand/product/model/category/official/url）→ Consistency検証（verdict/confidence/mismatch_reasons）。合格閾値は 0.85。
- 抽出LLMの初期ワード明示: 「商品特徴の抽出」ノードでブランド/カテゴリの初期値を明示し、他ブランドの混入を抑制。

## 解決策（方針）
- クエリ厳密化（商材/メーカー/製品/型番＋公式語＋除外語）
- `site:` 制約で公式/ブランドドメインを優先
- Identity抽出 → Consistency検証（confidence ≥ 0.85）で同一性を担保
- 辞書（別名/除外語）の継続チューニングとログ運用

現状: 設定反映済み、先方での再検証結果待ち（ステータス保留）。

## 結果
- 再現ケース（ウォーターランド、AGFスペシャルブレンド）で誤取得の抑制を確認。
- 社内運用を開始（今週の本番運用対象）。不具合があれば随時チューニング。

## 再発防止・運用メモ
- ブランド別名辞書/除外語のメンテ継続。
- 公式が無い/弱い商材は、公式ニュース/製品一覧/PDFカタログ等を一次情報として許容。
- バリデータのログ（reject理由）を蓄積し、辞書/クエリにフィードバック。

## 原因（判明している範囲／仮説）
※必要に応じて追記

## 解決方法（実施手順・設定値）
※必要に応じて追記
