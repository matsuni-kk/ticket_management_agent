---
file_type: "response"
ticket_id: "TKT-20250820-003"
responder: "matsuni"
response_date: "2025-08-25"
status: "解決策提示"
resolution_status: "解決済"
issued_at: "2025-08-25"
due_date: "2025-08-26"
ball_holder: "先方"
---

# 調査コンテンツ執筆ワークフロー：セクション別ルール適用問題の最終解決

## 原因
**過剰プロンプトによる制御困難**: 単一LLMノードで4つのセクションルール（事前情報・選び方・選び方_導入h3・QAセクション）を条件分岐制御することで、プロンプトが複雑化し、特に「選び方_導入h3」の100文字制限が正確に適用されない問題。

**iteration output selector not foundエラー**: セクションイテレーション処理における出力セレクター設定の不具合。

## 解決方法

### 最終解決策：LLMノードのセクション別分離
**実装アプローチ**: 今までのセクション執筆単体だと過剰なプロンプトで制御が難しそうだったので、**LLMノードをセクションごとに分けてあとで結合する**という方法で解決。

#### 改善内容
1. **構造の最適化**
   ```
   旧: 単一LLMノード + 複雑な条件分岐プロンプト
   新: セクション別LLMノード + 結合処理
   ```

2. **セクション別専用化**
   - 事前情報専用LLMノード
   - 選び方専用LLMノード  
   - **選び方_導入h3専用LLMノード**（100文字制限特化）
   - QAセクション専用LLMノード

3. **エラー解決**
   - iteration output selector not foundエラーの修正
   - イテレーション処理の安定化

### 期待される改善効果
- **文字数追随力の向上**: 選び方_導入h3で100文字制限の確実な適用
- **制御精度向上**: セクション別プロンプトによる誤適用防止
- **処理安定性**: イテレーションエラーの解消
- **保守性向上**: セクション追加時の拡張容易性

## 顧客確認・検証結果
**提供完了**: 修正版ワークフローファイル2個を提供済み

**検証項目**:
- 選び方_導入h3セクション: 600文字→100文字程度への適正化
- iteration output selector not foundエラーの解消
- 全セクションでの適切なルール適用確認

8/26期限内での動作確認をお願いします。修正版により文字数制御の大幅な改善を実現しました。