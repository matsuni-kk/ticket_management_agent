---
file_type: "inquiry"
ticket_id: "TKT-20250820-003"
company: "My Best"
reporter: "Yuna Kamachi"
date: "2025-08-20"
status: "新規"
category: "機能改善要望"
priority: "中"
related_systems: ["Dify", "調査コンテンツ執筆ワークフロー", "セクション別ルール適用"]
related_files: ["★調査_執筆実行（編集中） (7).yml"]
technical_issue: "セクションタイプ別執筆ルールの適用不具合"
deadline: "2025-08-26"
section_types: ["事前情報", "選び方", "選び方_導入h3", "QAセクション"]
issued_at: "2025-08-20"
due_date: "2025-08-26"
ball_holder: "当方"
---

# 問い合わせ内容 - 調査コンテンツ執筆ワークフローのセクション別ルール適用問題

## 問い合わせ者: Yuna Kamachi  
## 問い合わせ日時: 2025-08-20 15:24

@matsuni cc @miyatti
まつにぃさん、お疲れ様です！
調査コンテンツの執筆ワークフローについてご相談です🙏

## やりたいこと
**執筆ルールをセクションごとに付与したい**

→これまでコンテンツ全体に文章の展開方法やNG例などの統一のルールを付与していたのですが、実際はセクションごとに少しルールが異なるので、コンテンツセクション（事前情報・選び方・QAセクションの3タイプ）ごとに違うルールを適用したいと思っています。

## 私の方でやったこと

### 実装済み機能
1. **「セクションタイプ自動判定」ノードを作成**
   - 各セクションに `section_type`（事前情報, 選び方, 選び方_導入h3, QAセクション）を付与する

2. **「セクション執筆」ノードのプロンプト修正**
   - 事前情報, 選び方, 選び方_導入h3, QAセクションの4つのパターンのルールを書き分けた

## うまくいかないこと
**❌ 選び方_導入h3のルールが適用されない**

### 具体的問題
- h4を作成する場合、h3は100文字程度の導入文だけの執筆で良い
- **現状**: 今の設定だとうまく適用されず600文字程度の文章が出てきてしまう
- **推定**: おそらく「B. 選び方セクションの執筆ルール」が適用されている
- **確認済み**: 「セクションタイプ自動判定」ノードでは `section_type=選び方_導入h3` と正しく認識されている

## 調査コンテンツの構造と適用ルール

### コンテンツ階層構造
```
h2：事前情報　→【A. 事前情報セクションの執筆ルール】
h2：選び方　→ 執筆しなくていい
├─ h3：選び方1　→【D. 選び方_導入h3セクションの執筆ルール】※h4を作成する場合は導入文だけでいいので
   ├─ h4：選び方1-1　→【B. 選び方セクションの執筆ルール】
   └─ h4：選び方1-2　→【B. 選び方セクションの執筆ルール】
├─ h3：選び方2　→【B. 選び方セクションの執筆ルール】
└─ h3：選び方3　→【B. 選び方セクションの執筆ルール】
〜
h2：QAセクション　→【C. QAセクションの執筆ルール】
```

### 各ルールの特徴
- **A. 事前情報**: 基本的な情報提供ルール
- **B. 選び方**: 標準的な選び方解説（通常の文字数）
- **C. QAセクション**: Q&A形式の執筆ルール
- **D. 選び方_導入h3**: **100文字程度の短い導入文のみ**（重要）

## 技術的な質問・相談

### 1. 根本的な設計について
改善したいんですが、そもそもワークフローの流れがイマイチなどあれば教えていただきたいです。
**本来はif/elseのノードとか使ったほうがいいんですかね・・💦**

### 2. 具体的解決方法
- セクションタイプの判定は正常に動作しているが、ルール適用で問題発生
- 「選び方_導入h3」の特別ルール（100文字制限）が適用されない原因
- より確実にセクション別ルールを適用する方法

### 3. 期限について
こちらお忙しいところ恐縮ですが、**8/26までにご回答いただけますと幸いです🐰** 
難しい場合はおっしゃってくださいませ！

## 提供ファイル
- **メインワークフロー**: ★調査_執筆実行（編集中） (7).yml（6,249行）
- **アプリ設定**:
  ```yaml
  app:
    description: ''
    icon: 🤖
    icon_background: '#FFEAD5'
    mode: workflow
  ```

## 期待する改善効果
- **セクション特性の活用**: 各セクションの特性に応じた最適な執筆ルール適用
- **コンテンツ品質向上**: より適切な文字数・表現での執筆実現
- **運用効率化**: 手動修正の削減と自動化精度の向上

この問題の解決により、調査コンテンツの品質が大幅に向上し、セクション特性に応じた最適なコンテンツ生成が実現されることが期待されます。