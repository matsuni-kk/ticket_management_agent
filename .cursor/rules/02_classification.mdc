---
description: チケット分類・優先度付け・割り当てシステム
globs:
alwaysApply: false
---
# ==========================================================
# 02_ticket_classification.mdc - チケット分類・優先度付け・割り当てシステム
# ==========================================================

path_reference: "ticket_management_paths.mdc"

# ======== チケット分類システム統合エージェント ========

system_capabilities:
  intelligent_classification: "機械学習と専門知識を組み合わせた高精度な自動分類により、技術・業務・緊急度の多次元分類を実現する分類機能"
  priority_matrix: "影響度×緊急度マトリックス、顧客重要度、SLA条件を総合した動的優先度算出による最適な作業順序決定機能"
  resource_matching: "担当者のスキルセット、稼働状況、過去実績を分析した最適なリソース割り当てとワークロード平準化機能"
  sla_management: "顧客契約のSLA条件、エスカレーション規則、対応期限を自動管理する包括的SLA遵守支援機能"
  escalation_automation: "優先度、経過時間、対応状況に基づく自動エスカレーション実行とステークホルダー通知機能"
  analytics_insights: "分類パターン、処理時間、成功率の継続的分析による分類精度向上と運用最適化支援機能"

# ======== Phase 1: 分類・優先度算出フェーズ ========

phase_1_description: |
  多次元分析による精密なチケット分類と動的優先度算出を実行します。
  技術カテゴリ、業務影響度、緊急度を統合的に評価し、SLA条件と顧客重要度を反映した
  客観的で一貫性のある分類・優先度付けを自動実現します。

# ======== Phase 2: 割り当て・配信フェーズ ========

phase_2_description: |
  最適なリソース割り当てと効率的な作業配信を実行します。
  スキルマッチング、ワークロード分析、SLA遵守を総合考慮した担当者選定と
  自動通知・エスカレーション設定により、迅速で確実な対応開始を保証します。

# ======== 統合オプション質問 ========

ticket_classification_questions:
  - key: "ticket_content"
    prompt: "分類対象のチケット内容を入力してください："
    type: "multiline"
    required: true
    placeholder: "チケットID、タイトル、詳細内容、顧客情報等"

  - key: "customer_tier"
    prompt: "顧客の契約階層を選択してください："
    type: "select"
    options: ["エンタープライズ", "ビジネス", "スタンダード", "ベーシック", "不明"]
    required: false

  - key: "business_impact"
    prompt: "ビジネス影響度を評価してください："
    type: "select"
    options: ["自動判定", "重大（業務停止）", "高（業務遅延）", "中（機能制限）", "低（軽微な問題）"]
    required: false

  - key: "technical_complexity"
    prompt: "技術的複雑度を評価してください："
    type: "select"
    options: ["自動判定", "高（専門知識必要）", "中（標準的作業）", "低（定型作業）"]
    required: false

  - key: "resource_preference"
    prompt: "担当者の希望があれば指定してください："
    type: "text"
    required: false
    placeholder: "例：田中（過去に類似対応）、技術チーム、特定スキル要求等"

  - key: "sla_override"
    prompt: "SLA条件の特別考慮事項があれば入力してください："
    type: "text"
    required: false
    placeholder: "例：契約上の特別条件、緊急対応契約、延長申請済み等"

# ======== チケット分類プロセス ========

ticket_classification_steps:
  1_multi_dimensional_analysis:
    name: "多次元分類分析"
    phases:
      - "技術カテゴリ（インフラ・アプリ・データ・セキュリティ等）の精密分類による専門チーム振り分け"
      - "業務カテゴリ（運用・開発・保守・相談等）と処理パターンの特定による標準化された対応フロー適用"
      - "影響範囲（システム全体・特定機能・個別ユーザー等）の評価による適切なリソース配分決定"
    quality_standards:
      - "分類精度95%以上（専門家による検証基準）"
      - "主要カテゴリの完全網羅（技術・業務・影響度の3軸）"
      - "過去事例との一貫性維持による予測可能な分類結果"
  
  2_priority_calculation:
    name: "動的優先度算出"
    phases:
      - "緊急度（即座・当日・週内・月内）×影響度（重大・高・中・低）マトリックスによる基礎優先度算出"
      - "顧客重要度（契約規模・戦略性・関係性）とSLA条件（対応時間・解決期限）の重み付け調整"
      - "現在の処理状況（待機数・担当者稼働率・過去遅延率）を反映した動的優先度の最終決定"
    integration_points:
      - "CRMからの顧客重要度・契約条件情報の自動取得"
      - "チーム管理システムからのリソース稼働状況の実時間連携"
      - "SLA管理システムからの契約条件・期限情報の自動参照"

# ======== チケット分類ワークフロー ========

ticket_classification_workflow:
  phase_1:
    - name: "初期分類実行"
      action: "execute_classification"
      description: "機械学習モデルによる自動分類とルールベース検証"
      mandatory: true
    
    - name: "優先度マトリックス適用"
      action: "calculate_priority"
      description: "多要素分析による客観的優先度算出"
      mandatory: true
    
    - name: "SLA条件確認"
      action: "verify_sla"
      description: "契約条件と対応期限の確認・設定"
      mandatory: true

  phase_2:
    - name: "リソースマッチング"
      action: "match_resources"
      description: "スキル・稼働状況に基づく最適担当者選定"
      mandatory: true
    
    - name: "割り当て実行"
      action: "assign_ticket"
      description: "チケット割り当てと関係者への自動通知"
      mandatory: true
    
    - name: "エスカレーション設定"
      action: "setup_escalation"
      description: "自動エスカレーション条件とアラートの設定"
      mandatory: true

# ======== テンプレート ========

ticket_classification_template: |
  ---
  file_type: "ticket_classification"
  ticket_id: "{{ticket.id}}"
  generated_at: "{{meta.timestamp}}"
  domain: "ticket_management"
  agent: "TicketManagement"
  ---
  # チケット分類・割り当て結果 - {{meta.timestamp}}
  
  ## 🎫 チケット基本情報
  **チケットID**: {{ticket.id}}
  **タイトル**: {{ticket.title}}
  **会社名**: {{ticket.company_name}}
  **チケットパス**: tickets/{{ticket.company_name}}/in_progress/{{meta.date:YYYYMMDD}}_{{ticket.folder_name}}
  **受信日時**: {{ticket.created_at}}
  **処理日時**: {{meta.timestamp}}
  
  ### チケット内ファイル構成（統一規則・フロントマター付き）
  
  #### 各ファイルの標準フロントマター
  - **inquiry.md**: `file_type: "inquiry"` + 問い合わせメタデータ
  - **response.md**: `file_type: "response"` + 回答メタデータ  
  - **README.md**: `file_type: "ticket_summary"` + チケット概要メタデータ
  - **technical_analysis.md**: `file_type: "technical_analysis"` + 技術分析メタデータ
  - **technical_details.md**: `file_type: "technical_details"` + 技術詳細メタデータ
  
  #### 分類後更新フロントマター例
  ```yaml
  # README.mdの更新例
  ---
  file_type: "ticket_summary"
  ticket_id: "{{ticket.id}}"
  title: "{{ticket.title}}"
  company: "{{ticket.company_name}}"
  status: "{{classification.assigned_status}}"
  category: "{{classification.technical_category}}"
  priority: "{{priority.final_priority}}"
  assigned_to: "{{assignment.primary_assignee}}"
  estimated_hours: "{{prediction.estimated_hours}}"
  sla_deadline: "{{sla.resolution_target}}"
  ---
  ```
  
  ## 📊 分類結果
  
  ### 多次元分類
  - **技術カテゴリ**: {{classification.technical_category}}
  - **業務カテゴリ**: {{classification.business_category}}
  - **影響範囲**: {{classification.impact_scope}}
  - **処理パターン**: {{classification.process_pattern}}
  
  ### 優先度算出
  - **緊急度**: {{priority.urgency}} ({{priority.urgency_score}}/10)
  - **影響度**: {{priority.impact}} ({{priority.impact_score}}/10)
  - **顧客重要度**: {{priority.customer_importance}} ({{priority.customer_score}}/10)
  - **総合優先度**: {{priority.final_priority}} ({{priority.total_score}}/10)
  
  ## 👥 リソース割り当て
  
  ### 担当者情報
  - **主担当**: {{assignment.primary_assignee}}
  - **サポート**: {{assignment.support_members}}
  - **エスカレーション先**: {{assignment.escalation_target}}
  - **選定理由**: {{assignment.selection_reason}}
  
  ### スキルマッチング
  - **必要スキル**: {{skills.required}}
  - **担当者スキル**: {{skills.assignee_skills}}
  - **マッチング度**: {{skills.matching_score}}%
  
  ## 📅 SLA・期限管理
  
  ### 対応期限
  - **初回応答期限**: {{sla.first_response_deadline}}
  - **解決目標日**: {{sla.resolution_target}}
  - **SLA基準**: {{sla.contract_terms}}
  - **エスカレーション条件**: {{sla.escalation_rules}}
  
  ### 通知設定
  - **即座通知**: {{notifications.immediate}}
  - **進捗確認**: {{notifications.progress_check}}
  - **期限アラート**: {{notifications.deadline_alert}}
  
  ## 📈 予測・推奨事項
  
  ### 処理予測
  - **推定作業時間**: {{prediction.estimated_hours}}時間
  - **完了予測日**: {{prediction.completion_date}}
  - **成功確率**: {{prediction.success_probability}}%
  - **リスク要因**: {{prediction.risk_factors}}
  
  ### 改善提案
  - **効率化案**: {{suggestions.efficiency_improvements}}
  - **予防策**: {{suggestions.prevention_measures}}
  - **類似事例**: {{suggestions.similar_cases}}
  
  ## 🔄 次のアクション
  
  ### 即座実行項目
  1. {{actions.immediate_1}}
  2. {{actions.immediate_2}}
  3. {{actions.immediate_3}}
  
  ### フォローアップ
  - **24時間後**: {{actions.followup_24h}}
  - **3日後**: {{actions.followup_3d}}
  - **1週間後**: {{actions.followup_1w}}
  
  ---
  **文書情報**
  - 作成日: {{meta.timestamp}}
  - ドメイン: ticket_management
  - エージェント: SlackTicketAgent
  - 分類: チケット分類・割り当て

# エイリアス（互換性のため）
classification_template: |
  ---
  file_type: "ticket_classification"
  ticket_id: "{{ticket.id}}"
  generated_at: "{{meta.timestamp}}"
  domain: "ticket_management"
  agent: "TicketManagement"
  ---
  # チケット分類・割り当て結果 - {{meta.timestamp}}
  
  ## 🎫 チケット基本情報
  **チケットID**: {{ticket.id}}
  **タイトル**: {{ticket.title}}
  **会社名**: {{ticket.company_name}}
  **チケットパス**: tickets/{{ticket.company_name}}/in_progress/{{meta.date:YYYYMMDD}}_{{ticket.folder_name}}
  **受信日時**: {{ticket.created_at}}
  **処理日時**: {{meta.timestamp}}
  
  ### チケット内ファイル構成（統一規則・フロントマター付き）
  
  #### 各ファイルの標準フロントマター
  - **inquiry.md**: `file_type: "inquiry"` + 問い合わせメタデータ
  - **response.md**: `file_type: "response"` + 回答メタデータ  
  - **README.md**: `file_type: "ticket_summary"` + チケット概要メタデータ
  - **technical_analysis.md**: `file_type: "technical_analysis"` + 技術分析メタデータ
  - **technical_details.md**: `file_type: "technical_details"` + 技術詳細メタデータ
  
  #### 分類後更新フロントマター例
  ```yaml
  ---
  file_type: "ticket_summary"
  ticket_id: "{{ticket.id}}"
  title: "{{ticket.title}}"
  company: "{{ticket.company_name}}"
  status: "{{classification.assigned_status}}"
  category: "{{classification.technical_category}}"
  priority: "{{priority.final_priority}}"
  assigned_to: "{{assignment.primary_assignee}}"
  estimated_hours: "{{prediction.estimated_hours}}"
  sla_deadline: "{{sla.resolution_target}}"
  ---
  ```
  
  ## 📊 分類結果
  
  ### 多次元分類
  - **技術カテゴリ**: {{classification.technical_category}}
  - **業務カテゴリ**: {{classification.business_category}}
  - **影響範囲**: {{classification.impact_scope}}
  - **処理パターン**: {{classification.process_pattern}}

# ======== エラーハンドリング ========

error_handling:
  classification_uncertainty:
    message: "分類の信頼度が低下しています"
    recovery_actions:
      - "手動分類レビューの要求"
      - "類似事例による分類補完"
  
  resource_unavailable:
    message: "適切なリソースが利用できません"
    recovery_actions:
      - "代替担当者の自動選定"
      - "外部リソースの検討提案"

# ======== 設定 ========

ticket_classification_settings:
  auto_classification: true
  priority_recalculation: true
  resource_optimization: true
  sla_monitoring: true

# ======== 統合ポイント ========

integration_points:
  progress_tracking:
    trigger: "チケット割り当て完了"
    action: "call 03_progress_tracking.mdc => start_tracking"
  
  notification_system:
    trigger: "高優先度チケット検出"
    action: "immediate_stakeholder_notification"

# ======== 品質保証 ========

quality_assurance:
  mandatory_checks:
    - "分類カテゴリの完全性・一貫性確認"
    - "優先度算出の妥当性・公平性確認"
    - "SLA条件の正確性・遵守性確認"

# ======== 成功メトリクス ========

success_metrics:
  - "分類精度 > 95%"
  - "優先度適正率 > 90%"
  - "SLA遵守率 > 98%"
  - "リソース稼働率最適化 > 85%"
